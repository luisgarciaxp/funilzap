import{s as S,e as I,g as i}from"./chunk-7a2a1854.js";import{c as v,s as w}from"./chunk-4e43f09b.js";const b=["contains","not_contains","starts","equals"];function x({keywordRules:e,message:n}){return!n||typeof n!="string"||Array.isArray(e)===!1||!e||e.length===0?!1:e.some(({type:t})=>Object.values(b).includes(t)===!1)?(console.error("Alguma keywordRule tem um type inv\xE1lido",e),!1):e.some(({keywords:t})=>Array.isArray(t)===!1||!t||t.length===0||t.some(a=>typeof a!="string"))?(console.error("Alguma keywordRule tem um array de keywords inv\xE1lido",e),!1):e.every(({keywords:t,type:a})=>L({type:a,keywords:t,message:n}))}function L({type:e,keywords:n,message:t}){switch(e){case"equals":return n&&n.some(a=>a===t);case"contains":return n&&n.some(a=>t.includes(a));case"not_contains":return n&&n.some(a=>!t.includes(a));case"starts":return n&&n.some(a=>t.substring(0,a.length)===a);default:return!1}}chrome.action.onClicked.addListener(()=>{chrome.tabs.query({url:"https://web.whatsapp.com/*",currentWindow:!0},e=>{e.length>0&&e[0].id?chrome.tabs.update(e[0].id,{highlighted:!0,selected:!0}):chrome.tabs.create({url:"https://web.whatsapp.com"})})});chrome.runtime.onInstalled.addListener(e=>{(e.reason==="install"||e.reason==="update")&&chrome.tabs.query({url:"https://web.whatsapp.com/*"},n=>{n.length>0&&n[0].id?chrome.tabs.reload(n[0].id):chrome.tabs.create({url:"https://web.whatsapp.com",active:!0})})});chrome.runtime.onMessage.addListener(({type:e,data:n},t,a)=>{var u;if(e==="WPPLoaded"&&t.origin==="https://web.whatsapp.com"&&((u=t==null?void 0:t.tab)==null?void 0:u.id)){const{nmb:c,wppVersion:l}=n;l&&S({wppVersion:l}),c&&S({nmb:c}),a({ZVExtensionId:I});const d=chrome!=null&&chrome.runtime?chrome.runtime.getManifest():{version_name:"Local Development",version:"Local Development"},f=d.version_name||d.version,o=new URLSearchParams;f&&o.append("version",f),c&&o.append("nmb",c),l&&o.append("wppVersion",l),o.append("extensionId",I),chrome.runtime.setUninstallURL(`https://zapvoice.com.br/uninstall-page?${o.toString()}`)}});chrome.runtime.onMessageExternal.addListener(async({type:e,data:n},t,a)=>{var u,c,l,d,f,o,p;if(!(!((u=t.url)!=null&&u.includes("web.whatsapp.com"))||e!=="checkTriggersShouldFireByMessage"&&e!=="getIndexesFromStorage"&&e!=="getSmallItemFromStorage"&&e!=="checkPremium"&&e!=="getFlags"&&e!=="saveValidOnStorage")){if(e==="checkPremium")try{const{premium:r,data:m}=await v();a({type:e,response:{premium:r,data:m}})}catch(r){a({type:e,response:{premium:!1,data:r.toString()}})}else if(e==="saveValidOnStorage")await w();else if(e==="getIndexesFromStorage"){const r=(c=await i("audiosIndex"))!=null?c:[],m=(l=await i("mensagensIndex"))!=null?l:[],g=(d=await i("mediasIndex"))!=null?d:[],h=(f=await i("docsIndex"))!=null?f:[],s=(o=await i("funis"))!=null?o:[];a({type:e,response:{mensagensIndex:m,audiosIndex:r,mediasIndex:g,docsIndex:h,funis:s}})}else if(e==="getSmallItemFromStorage"){const{id:r}=n,m=await i(r);a({type:e,response:{item:m}})}else if(e==="checkTriggersShouldFireByMessage"){const r=(p=await i("triggers"))!=null?p:[],{message:m}=n,g=r.reduce((h,s)=>(!!s.funnelId&&!!s.enabled&&!!s.keywordRules&&s.keywordRules.length>0&&x({message:m,keywordRules:s.keywordRules})&&h.push({triggerId:s.id,funnelId:s.funnelId,secondsBeforeSend:s.secondsBeforeSend,name:s.name,dontSendToContact:!!s.dontSendToContact}),h),[]);a({type:e,response:g})}else if(e==="getFlags"){const r=await i("flags");a({type:e,response:r})}}});chrome.runtime.onUpdateAvailable.addListener(()=>{chrome.runtime.reload()});
